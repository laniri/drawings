# Embedding Service Service

Embedding Service for generating feature vectors from children's drawings.

This service handles Vision Transformer model loading, caching, and embedding generation
with support for age-augmented embeddings and batch processing.

## Class: EmbeddingServiceError

Base exception for embedding service errors.

## Class: ModelLoadingError

Raised when model loading fails.

## Class: EmbeddingGenerationError

Raised when embedding generation fails.

## Class: DeviceManager

Manages GPU/CPU device detection and selection.

### device

Get the current device.

**Signature**: `device()`

### device_info

Get device information.

**Signature**: `device_info()`

### get_memory_usage

Get current memory usage if available.

**Signature**: `get_memory_usage()`

## Class: VisionTransformerWrapper

Wrapper for Vision Transformer model with caching and optimization.

### load_model

Load the Vision Transformer model with optional caching.

**Signature**: `load_model(use_cache)`

### is_loaded

Check if the model is loaded and ready.

**Signature**: `is_loaded()`

### get_model_info

Get information about the loaded model.

**Signature**: `get_model_info()`

## Class: EmbeddingService

Service for generating embeddings from children's drawings using Vision Transformers.

### initialize

Initialize the embedding service by loading the model.

**Signature**: `initialize(use_cache)`

### is_ready

Check if the service is ready to generate embeddings.

**Signature**: `is_ready()`

### get_service_info

Get comprehensive service information.

**Signature**: `get_service_info()`

### generate_embedding

Generate embedding for a single image.

Args:
    image: PIL Image or numpy array
    age: Optional age information to concatenate
    use_cache: Whether to use caching for embeddings
    
Returns:
    numpy array containing the embedding vector

**Signature**: `generate_embedding(image, age, use_cache)`

### generate_batch_embeddings

Generate embeddings for multiple images in batches.

Args:
    images: List of PIL Images or numpy arrays
    ages: Optional list of ages corresponding to images
    batch_size: Number of images to process in each batch
    use_cache: Whether to use caching for embeddings
    
Returns:
    List of numpy arrays containing embedding vectors

**Signature**: `generate_batch_embeddings(images, ages, batch_size, use_cache)`

### get_embedding_dimension

Get the dimension of embeddings generated by this service.

**Signature**: `get_embedding_dimension(include_age)`

### clear_cache

Clear the embedding cache.

**Signature**: `clear_cache()`

### store_embedding_for_db

Store an embedding for database persistence with serialization.

Args:
    drawing_id: Database ID of the drawing
    embedding: Embedding array to store
    age: Optional age information
    model_type: Type of model used for embedding
    
Returns:
    Tuple of (serialized_bytes, dimension)

**Signature**: `store_embedding_for_db(drawing_id, embedding, age, model_type)`

### retrieve_embedding_from_db

Retrieve an embedding from database with caching support.

Args:
    drawing_id: Database ID of the drawing
    serialized_data: Serialized embedding data from database
    age: Optional age information
    model_type: Type of model used for embedding
    
Returns:
    Embedding array or None if not found

**Signature**: `retrieve_embedding_from_db(drawing_id, serialized_data, age, model_type)`

### invalidate_embedding_cache

Invalidate cached embedding for a specific drawing.

Args:
    drawing_id: Database ID of the drawing
    age: Optional age information
    model_type: Type of model used for embedding
    
Returns:
    True if cache entry was removed

**Signature**: `invalidate_embedding_cache(drawing_id, age, model_type)`

### get_storage_stats

Get embedding storage and cache statistics.

**Signature**: `get_storage_stats()`

## Class: EmbeddingPipeline

High-level pipeline for processing drawings and generating embeddings.

### process_drawing

Process a single drawing through the complete embedding pipeline.

Args:
    image: PIL Image or numpy array
    age: Optional age information
    drawing_id: Optional database ID for tracking
    use_cache: Whether to use embedding cache
    
Returns:
    Dictionary containing embedding and metadata

**Signature**: `process_drawing(image, age, drawing_id, use_cache)`

### process_batch

Process multiple drawings through the embedding pipeline.

Args:
    images: List of PIL Images or numpy arrays
    ages: Optional list of ages
    drawing_ids: Optional list of database IDs
    batch_size: Batch size for processing
    use_cache: Whether to use embedding cache
    
Returns:
    List of result dictionaries

**Signature**: `process_batch(images, ages, drawing_ids, batch_size, use_cache)`

### get_pipeline_stats

Get pipeline processing statistics.

**Signature**: `get_pipeline_stats()`

### reset_stats

Reset pipeline statistics.

**Signature**: `reset_stats()`

